<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Install VMflow</title>
  <link rel="icon" type="image/png" href="vending-machine_10317047.png">

  <!-- ESP Web Tools -->
  <script type="module" src="https://unpkg.com/esp-web-tools@9.1.0/dist/web/install-button.js?module"></script>
</head>

<body style="margin:0; font-family:Arial, sans-serif; background:#fafafa; display:flex; flex-direction:column; align-items:center; padding:20px; min-height:100vh;">

  <!-- IMAGEM NO TOPO -->
  <img src="mdb-slave-esp32s3_pcb_v2.jpg"
       alt="VMflow Board"
       style="width:260px; height:auto; border-radius:20px; margin:20px 0; box-shadow:0 4px 12px rgba(0,0,0,0.15);">

  <!-- TÍTULO -->
  <h1 style="margin-top:0; font-size:28px; font-weight:600; color:#333;">
    Install VMflow Firmware
  </h1>

  <!-- INSTRUÇÕES -->
  <div style="max-width:500px; text-align:left; margin-top:10px; margin-bottom:20px; color:#444; font-size:16px; line-height:1.5;">
    <p style="margin:6px 0;"><strong>1)</strong> Plug in your ESP to a USB port. We will install <strong>VMflow v3.1.0</strong> to it.</p>
    <p style="margin:6px 0;"><strong>2)</strong> Hit <strong>"Install"</strong> and select the correct COM port.</p>
    <p style="margin:6px 0;"><strong>3)</strong> Get VMflow installed and connected in less than 3 minutes!</p>
  </div>

  <!-- LINHA: LABEL + SELECT -->
  <div style="display:flex; align-items:center; gap:10px; margin-bottom:20px;">
      <span style="font-size:16px; color:#444;">Firmware Version:</span>

      <select id="versionSelect"
              style="padding:8px 12px; font-size:16px; border-radius:6px; border:1px solid:#bbb; background:white;">
      </select>
  </div>

  <!-- BOTÃO DO ESP WEB TOOLS -->
  <esp-web-install-button id="installButton" manifest="manifest.json"></esp-web-install-button>

  <!-- RODAPÉ -->
  <div style="margin-top:auto; padding-top:40px; font-size:14px; color:#666; text-align:center;">
    <a href="https://github.com/nodestark/mdb-esp32-cashless"
       style="color:#0073e6; text-decoration:none; margin-right:15px;">
       GitHub Project
    </a>

    <a href="https://vmflow.xyz"
       style="color:#0073e6; text-decoration:none;">
       vmflow.xyz
    </a>
  </div>

  <script>
    const select = document.getElementById("versionSelect");
    const installButton = document.getElementById("installButton");

    async function loadVersions() {
      const response = await fetch("versions.json");
      const data = await response.json();

      data.builds.forEach(v => {
        let opt = document.createElement("option");
        opt.value = v.manifest;
        opt.textContent = v.version.toUpperCase();
        select.appendChild(opt);
      });

      // Ajusta manifest inicial
      installButton.setAttribute("manifest", select.value);
    }

    // Atualiza o manifest ao clicar
    installButton.addEventListener("click", () => {
      installButton.setAttribute("manifest", select.value);
    });

    loadVersions();
  </script>

</body>
</html>
